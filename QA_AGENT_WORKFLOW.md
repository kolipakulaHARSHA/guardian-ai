# QA Agent Workflow - Complete Guide

## Overview

The QA (Question-Answering) Agent uses **RAG (Retrieval Augmented Generation)** to answer questions about GitHub repositories. It combines semantic search with LLM reasoning to provide accurate, source-backed answers.

---

## ğŸ”„ Complete Workflow

### **Phase 1: Initialization**

```
User Action: python guardian_agent_simple.py --interactive
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GuardianAgentSimple.__init__()                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚  â€¢ Initialize Gemini LLM                             â”‚
â”‚  â€¢ Set model: gemini-2.5-pro-preview-03-25           â”‚
â”‚  â€¢ Initialize QA session variables:                  â”‚
â”‚    - qa_tool_instance = None                         â”‚
â”‚    - qa_repo_url = None                              â”‚
â”‚    - qa_temp_dir = None                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    âœ… Agent Ready!
```

---

### **Phase 2: Setting Up QA Session**

```
User Command: set repo https://github.com/user/repo
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  setup_qa_session(repo_url)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 1: Import Dependencies        â”‚
        â”‚  â€¢ tempfile (for temp directory)    â”‚
        â”‚  â€¢ git (for cloning)                â”‚
        â”‚  â€¢ RepoQATool (the QA engine)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2: Cleanup Old Session        â”‚
        â”‚  â€¢ cleanup_qa_session()             â”‚
        â”‚  â€¢ Remove any existing temp files   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 3: Initialize QA Tool         â”‚
        â”‚  â€¢ qa_tool = RepoQATool()           â”‚
        â”‚  â€¢ Store in qa_tool_instance        â”‚
        â”‚  â€¢ Store repo_url in qa_repo_url    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 4: Clone Repository           â”‚
        â”‚  ğŸ“¥ Cloning repository...           â”‚
        â”‚  â€¢ Create temp directory            â”‚
        â”‚  â€¢ git.Repo.clone_from(url, dir)    â”‚
        â”‚  âœ“ Repository cloned                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Time: ~5-10 seconds
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 5: Index Repository           â”‚
        â”‚  ğŸ“š Indexing repository...          â”‚
        â”‚  (See detailed indexing flow below) â”‚
        â”‚  âœ“ Indexed 150 documents            â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Time: ~20-40 seconds
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Result: Session Active                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                             â”‚
â”‚  â€¢ qa_tool_instance = <QA Tool Object>               â”‚
â”‚  â€¢ qa_repo_url = "https://github.com/user/repo"      â”‚
â”‚  â€¢ qa_temp_dir = "/tmp/guardian_qa_xxxxx"            â”‚
â”‚                                                       â”‚
â”‚  âœ… QA session ready! Indexed 150 documents.         â”‚
â”‚  ğŸ’¡ You can now ask questions without the URL.       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **Phase 3: Repository Indexing (Detailed)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  qa_tool.index_repository(repo_path)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 1: Scan for Files             â”‚
        â”‚  â€¢ Supported extensions:            â”‚
        â”‚    - Code: .py, .js, .ts, .java     â”‚
        â”‚    - Docs: .md, .txt, .rst          â”‚
        â”‚    - Config: .json, .yaml, .yml     â”‚
        â”‚    - Web: .html, .css               â”‚
        â”‚  â€¢ Ignore:                          â”‚
        â”‚    - node_modules/, venv/, .git/    â”‚
        â”‚    - __pycache__/, build/, dist/    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2: Load Documents             â”‚
        â”‚  For each file:                     â”‚
        â”‚  â€¢ Read content (UTF-8)             â”‚
        â”‚  â€¢ Create Document object:          â”‚
        â”‚    - page_content = file contents   â”‚
        â”‚    - metadata = {                   â”‚
        â”‚        source: "path/to/file.py"    â”‚
        â”‚        file_name: "file.py"         â”‚
        â”‚        extension: ".py"             â”‚
        â”‚      }                              â”‚
        â”‚  âœ“ Loaded 150 documents             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 3: Split into Chunks          â”‚
        â”‚  â€¢ RecursiveCharacterTextSplitter   â”‚
        â”‚  â€¢ chunk_size = 1000 chars          â”‚
        â”‚  â€¢ chunk_overlap = 200 chars        â”‚
        â”‚  â€¢ Preserves code structure         â”‚
        â”‚  âœ“ Created 500 chunks               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 4: Create Embeddings          â”‚
        â”‚  For each chunk:                    â”‚
        â”‚  â€¢ GoogleGenerativeAIEmbeddings     â”‚
        â”‚  â€¢ model: "models/embedding-001"    â”‚
        â”‚  â€¢ Convert text â†’ 768D vector       â”‚
        â”‚  â€¢ Capture semantic meaning         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Time: ~20-30 seconds
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 5: Build Vector Store         â”‚
        â”‚  â€¢ FAISS.from_documents()           â”‚
        â”‚  â€¢ Store all embeddings             â”‚
        â”‚  â€¢ Enable fast similarity search    â”‚
        â”‚  â€¢ Create retriever (k=5)           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 6: Create QA Chain            â”‚
        â”‚  â€¢ Prompt template with context     â”‚
        â”‚  â€¢ Chain: retriever â†’ prompt â†’ LLM â”‚
        â”‚  â€¢ Output parser for clean answers  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    âœ… Indexing Complete!
```

---

### **Phase 4: Asking Questions (Fast Path)**

```
User: what does this repo do?
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Interactive Mode Router            â”‚
        â”‚  â€¢ Check: QA session active? âœ“      â”‚
        â”‚  â€¢ Check: Question has URL? âœ—       â”‚
        â”‚  â€¢ Check: Question has PDF? âœ—       â”‚
        â”‚  â†’ Route to: ask_qa() (FAST!)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ask_qa(question)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 1: Validate Session           â”‚
        â”‚  â€¢ Check qa_tool_instance exists    â”‚
        â”‚  â€¢ If not: return error message     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2: Call QA Tool               â”‚
        â”‚  result = qa_tool.ask_question(q)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  qa_tool.ask_question(question) - CORE LOGIC         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2a: Semantic Retrieval        â”‚
        â”‚  â€¢ Convert question â†’ embedding     â”‚
        â”‚  â€¢ Search FAISS vector store        â”‚
        â”‚  â€¢ Find top 5 similar chunks        â”‚
        â”‚  â€¢ Return relevant code/docs        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Time: ~500ms
                              â”‚
                Example Results:
                â”œâ”€ README.md (lines 1-50)
                â”œâ”€ main.py (lines 120-180)
                â”œâ”€ auth.py (lines 45-90)
                â”œâ”€ docs/overview.md (lines 10-60)
                â””â”€ config.py (lines 5-25)
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2b: Build Context             â”‚
        â”‚  Combine retrieved chunks:          â”‚
        â”‚  "Context from README.md:           â”‚
        â”‚   This is a web application...      â”‚
        â”‚                                     â”‚
        â”‚   Context from main.py:             â”‚
        â”‚   def main():                       â”‚
        â”‚       app = create_app()...         â”‚
        â”‚                                     â”‚
        â”‚   Context from auth.py:             â”‚
        â”‚   def authenticate(user):..."       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2c: Generate Answer           â”‚
        â”‚  Prompt:                            â”‚
        â”‚  "Answer based on this context:     â”‚
        â”‚   [retrieved chunks]                â”‚
        â”‚                                     â”‚
        â”‚   Question: what does this do?      â”‚
        â”‚                                     â”‚
        â”‚   Provide detailed answer with      â”‚
        â”‚   specific examples from code."     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2d: LLM Processing            â”‚
        â”‚  â€¢ Gemini reads context             â”‚
        â”‚  â€¢ Analyzes code snippets           â”‚
        â”‚  â€¢ Synthesizes answer               â”‚
        â”‚  â€¢ Cites specific files             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Time: ~1-2 seconds
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 3: Format Response            â”‚
        â”‚  â€¢ Extract answer text              â”‚
        â”‚  â€¢ Get source file names            â”‚
        â”‚  â€¢ Add source citations             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚  Answer: "This repository is a web application       â”‚
â”‚  that provides user authentication and data          â”‚
â”‚  management. The main entry point is in main.py      â”‚
â”‚  which creates the Flask app. Authentication is      â”‚
â”‚  handled via JWT tokens in auth.py..."              â”‚
â”‚                                                       â”‚
â”‚  ğŸ“ Sources: README.md, main.py, auth.py            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                Total Time: ~2 seconds âš¡
```

---

### **Phase 5: Asking Questions (Full Agent Path)**

```
User: how does authentication work in the repo?
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Interactive Mode Router            â”‚
        â”‚  â€¢ Contains "repo" keyword          â”‚
        â”‚  â†’ Route to: ask() (Full Agent)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ask(query) â†’ run(query)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  STEP 1: PLANNING                   â”‚
        â”‚  _create_plan(query)                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 1a: Check Active Session      â”‚
        â”‚  â€¢ qa_repo_url exists? âœ“            â”‚
        â”‚  â€¢ Add context to prompt:           â”‚
        â”‚    "IMPORTANT: Active session:      â”‚
        â”‚     https://github.com/user/repo"   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 1b: LLM Planning              â”‚
        â”‚  Prompt:                            â”‚
        â”‚  "Available tools:                  â”‚
        â”‚   1. Legal_Analyzer                 â”‚
        â”‚   2. Code_Auditor                   â”‚
        â”‚   3. QA_Tool                        â”‚
        â”‚                                     â”‚
        â”‚   Active session: <url>             â”‚
        â”‚   Query: how does auth work?        â”‚
        â”‚                                     â”‚
        â”‚   Which tools needed?"              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 1c: Parse Plan                â”‚
        â”‚  {                                  â”‚
        â”‚    "tools_needed": ["QA_Tool"],     â”‚
        â”‚    "execution_order": ["QA_Tool"],  â”‚
        â”‚    "repo_url": "<active session>",  â”‚
        â”‚    "question": "how does auth..."   â”‚
        â”‚  }                                  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Time: ~2-3 seconds
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  STEP 2: EXECUTION                  â”‚
        â”‚  _execute_plan(plan)                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2a: Execute QA_Tool           â”‚
        â”‚  _run_qa_tool(repo_url, question)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2b: Check for Existing Sessionâ”‚
        â”‚  â€¢ repo_url == qa_repo_url? âœ“       â”‚
        â”‚  â€¢ qa_tool_instance exists? âœ“       â”‚
        â”‚  â†’ Use cached session! (No clone)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 2c: Ask Question              â”‚
        â”‚  â€¢ qa_tool.ask_question(q)          â”‚
        â”‚  â€¢ Same retrieval process as before â”‚
        â”‚  â€¢ Return answer with sources       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Time: ~2 seconds
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  STEP 3: SYNTHESIS                  â”‚
        â”‚  _synthesize_answer(query, results) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 3a: Build Synthesis Prompt    â”‚
        â”‚  "You executed these tools:         â”‚
        â”‚   QA_Tool: [answer about auth...]   â”‚
        â”‚                                     â”‚
        â”‚   User query: how does auth work?   â”‚
        â”‚                                     â”‚
        â”‚   Provide comprehensive answer."    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Step 3b: Generate Final Answer     â”‚
        â”‚  â€¢ LLM formats the response         â”‚
        â”‚  â€¢ Adds structure and clarity       â”‚
        â”‚  â€¢ Returns polished answer          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                Time: ~1-2 seconds
                              â”‚
                              â–¼
                Total Time: ~5-7 seconds
```

---

## ğŸ” Technical Deep Dive

### **1. Vector Embeddings**

```
Text Chunk: "def authenticate(user, password):"
                              â”‚
                              â–¼
        Google Embedding API (embedding-001)
                              â”‚
                              â–¼
Vector: [0.123, -0.456, 0.789, ..., 0.234]  (768 dimensions)
                              â”‚
                              â–¼
        Stored in FAISS index
```

**Purpose:** Convert text to numbers that capture semantic meaning.  
**Benefit:** "how to login" finds "authenticate" even without exact words.

### **2. Similarity Search**

```
Question: "how does authentication work?"
                              â”‚
                              â–¼
Question Embedding: [0.111, -0.333, 0.555, ...]
                              â”‚
                              â–¼
        Compare with ALL chunk embeddings
                              â”‚
        Using cosine similarity:
        similarity = (query Â· chunk) / (||query|| * ||chunk||)
                              â”‚
                              â–¼
Top 5 Most Similar Chunks:
1. auth.py lines 45-90      (similarity: 0.89)
2. README.md lines 120-160  (similarity: 0.84)
3. middleware.py lines 20-50 (similarity: 0.78)
4. config.py lines 10-30    (similarity: 0.72)
5. docs/auth.md lines 5-40  (similarity: 0.69)
```

### **3. RAG Chain**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Question: "how does auth work?"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Retriever            â”‚
        â”‚  (FAISS search)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Context + Question   â”‚
        â”‚  (Prompt Template)    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  LLM                  â”‚
        â”‚  (Gemini)             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  String Parser        â”‚
        â”‚  (Clean output)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Answer               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Performance Metrics

### **Setup Times**

| Operation | Time | Notes |
|-----------|------|-------|
| Clone repo | 5-10s | Depends on repo size |
| Load documents | 2-5s | ~150 files |
| Create chunks | 1-2s | ~500 chunks |
| Generate embeddings | 15-25s | API calls |
| Build FAISS index | 1-3s | In-memory |
| **Total Setup** | **25-45s** | One-time cost |

### **Query Times**

| Operation | Time | Notes |
|-----------|------|-------|
| Vector search | 0.5s | FAISS is fast |
| LLM inference | 1-2s | Gemini API |
| **Total Query** | **2-3s** | Per question |

### **Session Reuse Benefit**

```
Scenario: 5 questions about a repository

WITHOUT session reuse:
Question 1: 25s setup + 2s query = 27s
Question 2: 25s setup + 2s query = 27s
Question 3: 25s setup + 2s query = 27s
Question 4: 25s setup + 2s query = 27s
Question 5: 25s setup + 2s query = 27s
Total: 135 seconds

WITH session reuse:
Question 1: 25s setup + 2s query = 27s
Question 2: 0s setup  + 2s query = 2s   âš¡
Question 3: 0s setup  + 2s query = 2s   âš¡
Question 4: 0s setup  + 2s query = 2s   âš¡
Question 5: 0s setup  + 2s query = 2s   âš¡
Total: 35 seconds

Speedup: 3.86x faster! ğŸš€
```

---

## ğŸ¯ Key Components

### **1. RepoQATool Class**

```python
class RepoQATool:
    def __init__(self, model_name):
        # Initialize embeddings and LLM
        self.embeddings = GoogleGenerativeAIEmbeddings(...)
        self.llm = ChatGoogleGenerativeAI(...)
        self.vectorstore = None
        self.retriever = None
        self.qa_chain = None
    
    def index_repository(self, repo_path):
        # Load, split, embed, and index files
        # Returns: {'status': 'success', 'documents_count': 150}
    
    def ask_question(self, question):
        # Retrieve context and generate answer
        # Returns: {'status': 'success', 'answer': '...', 'sources': [...]}
```

### **2. GuardianAgentSimple Integration**

```python
class GuardianAgentSimple:
    def __init__(self):
        self.qa_tool_instance = None  # Cached QA tool
        self.qa_repo_url = None       # Active repo URL
        self.qa_temp_dir = None       # Temp directory
    
    def setup_qa_session(self, repo_url):
        # Clone, index, and cache QA tool
    
    def ask_qa(self, question):
        # Direct question to cached QA tool
    
    def _run_qa_tool(self, repo_url, question):
        # Check for existing session, reuse if possible
```

---

## ğŸ’¡ Smart Features

### **1. Session Awareness**

The planner knows about active sessions:

```python
if self.qa_repo_url:
    qa_context = f"""
    IMPORTANT: Active QA session for {self.qa_repo_url}
    User questions about "the repo" refer to this URL.
    """
```

### **2. Automatic Session Reuse**

```python
if self.qa_tool_instance and self.qa_repo_url == repo_url:
    # Use existing session - no cloning!
    return self.qa_tool_instance.ask_question(question)
```

### **3. Intelligent Routing**

```python
# Fast path: Direct to QA if simple question
if qa_session_active and not has_url_or_pdf(query):
    return ask_qa(query)

# Full path: Use agent for complex tasks
else:
    return ask(query)
```

---

## ğŸ‰ Summary

The QA Agent workflow combines:

1. **âœ… Git Cloning** - Get the repository code
2. **âœ… Document Loading** - Read all relevant files
3. **âœ… Text Chunking** - Split into manageable pieces
4. **âœ… Vector Embedding** - Convert to semantic vectors
5. **âœ… FAISS Indexing** - Fast similarity search
6. **âœ… Semantic Retrieval** - Find relevant context
7. **âœ… LLM Generation** - Synthesize answers
8. **âœ… Session Caching** - Reuse for speed

**Result:** Fast, accurate answers about any codebase with source citations! ğŸš€
